<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Draw a Digit</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600&display=swap" rel="stylesheet">
    <style>
      :root { --bg:#0f172a; --card:#111827; --accent:#22d3ee; --text:#e2e8f0; --muted:#94a3b8; }
      *{ box-sizing:border-box; }
      body{ margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; background:radial-gradient(circle at 20% 20%, #1e293b 0, #0f172a 40%), var(--bg); color:var(--text); font-family:'Space Grotesk', system-ui, -apple-system, sans-serif; }
      .card{ width:min(480px, 96vw); background:var(--card); border:1px solid #1f2937; border-radius:20px; padding:26px; box-shadow:0 15px 35px rgba(0,0,0,0.35); }
      h1{ margin:0 0 10px; font-size:26px; letter-spacing:-0.02em; }
      p.lead{ margin:0 0 16px; color:var(--muted); line-height:1.5; }
      .canvas-wrap{ background:#0b1224; border:1.5px dashed #334155; border-radius:16px; padding:14px; display:flex; flex-direction:column; gap:12px; align-items:center; }
      canvas{ background:#000; border-radius:12px; box-shadow:inset 0 0 0 1px #111827; touch-action:none; }
      .controls{ display:flex; gap:10px; width:100%; }
      button{ border:none; border-radius:12px; padding:10px 12px; font-weight:700; cursor:pointer; transition:transform 120ms ease, box-shadow 120ms ease; color:#0b1224; }
      .primary{ flex:1; background:linear-gradient(120deg, #22d3ee, #38bdf8); }
      .secondary{ background:#1f2937; color:var(--text); }
      button:hover{ transform:translateY(-1px); box-shadow:0 8px 24px rgba(34,211,238,0.35); }
      .result{ margin-top:16px; padding:12px 14px; border-radius:12px; background:rgba(34,211,238,0.07); border:1px solid rgba(34,211,238,0.35); display:none; }
      .result strong{ color:var(--accent); }
      .error{ color:#f87171; }
      .hint{ font-size:12px; color:var(--muted); margin-top:-4px; }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Draw a Digit</h1>
      <p class="lead">Sketch a digit below and we will predict it with the onboard MNIST model.</p>
      <div style="margin-bottom:10px;">
        <a href="/" style="color:#5838f8;text-decoration:none;font-weight:600;">← Back to home</a>
      </div>
      <div class="canvas-wrap">
        <canvas id="pad" width="280" height="280"></canvas>
        <div class="controls">
          <button id="clear" type="button" class="secondary">Clear</button>
          <button id="predict" type="button" class="primary">Predict</button>
        </div>
        <div class="hint">Tip: draw in white on black for best results.</div>
      </div>
      <div id="result" class="result"></div>
    </div>
    <script>
      const pad = document.getElementById('pad');
      const ctx = pad.getContext('2d');
      const clearBtn = document.getElementById('clear');
      const predictBtn = document.getElementById('predict');
      const result = document.getElementById('result');

      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, pad.width, pad.height);
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 18;
      ctx.lineCap = 'round';

      let drawing = false;
      function pos(e) {
        const rect = pad.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: clientX - rect.left, y: clientY - rect.top };
      }
      function start(e) { drawing = true; const p = pos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); }
      function move(e) { if (!drawing) return; const p = pos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); }
      function end() { drawing = false; }

      pad.addEventListener('mousedown', start);
      pad.addEventListener('mousemove', move);
      window.addEventListener('mouseup', end);
      pad.addEventListener('touchstart', (e) => { e.preventDefault(); start(e); });
      pad.addEventListener('touchmove', (e) => { e.preventDefault(); move(e); });
      window.addEventListener('touchend', end);

      clearBtn.addEventListener('click', () => {
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, pad.width, pad.height);
        ctx.strokeStyle = '#fff';
      });

      predictBtn.addEventListener('click', async () => {
        result.style.display = 'none';
        pad.toBlob(async (blob) => {
          if (!blob) return;
          const data = new FormData();
          data.append('image', blob, 'digit.png');
          try {
            const res = await fetch('/predict_digit', { method: 'POST', body: data });
            if (!res.ok) throw new Error('Request failed');
            const json = await res.json();
            result.innerHTML = `<strong>Predicted:</strong> ${json.result} <br><span>Label: ${json.label} · Confidence: ${(json.confidence * 100).toFixed(1)}%</span>`;
            result.classList.remove('error');
          } catch (err) {
            result.textContent = 'Error: could not get a prediction.';
            result.classList.add('error');
          }
          result.style.display = 'block';
        }, 'image/png');
      });
    </script>
  </body>
</html>
